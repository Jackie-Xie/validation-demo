<!-- Nav tabs s -->
<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#/main/jqValid#J_myForm" aria-controls="myForm" role="tab" data-toggle="tab">myForm</a></li>
    <li role="presentation"><a href="#/main/jqValid#J_otherForm" aria-controls="otherForm" role="tab" data-toggle="tab">otherForm</a></li>
</ul>
<!-- Nav tabs e -->
<div class="tab-content">
    <!-- jquery validation s -->
    <form role="tabpanel" class="form-horizontal tab-pane fade in active" id="J_myForm" method="post" novalidate>
        <div class="form-group mg0 mgt15 has-feedback">
            <label for="userName" class="col-sm-2 control-label"><span class="is-required">*</span> 用户名</label>
            <div class="col-sm-10 form-item">
                <input type="text" class="form-control" id="userName" ng-model="userForm.userName" placeholder="请输入2-16位" minlength="2" maxlength="16" required>
            </div>
        </div>
        <div class="form-group mg0">
            <label for="pwd" class="col-sm-2 control-label"><span class="is-required">*</span> 密码</label>
            <div class="col-sm-10 form-item">
                <input type="password" class="form-control" id="pwd" ng-model="userForm.pwd" placeholder="请输入8-25位数字字母组合" pattern="/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,25}$/" required>
            </div>
        </div>
        <div class="form-group mg0">
            <label for="repeat-pwd" class="col-sm-2 control-label"><span class="is-required">*</span> 确认密码</label>
            <div class="col-sm-10 form-item">
                <input type="password" class="form-control" id="repeat-pwd" ng-model="userForm.repeatPwd" placeholder="请再次输入密码" pattern="/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,25}$/" equalTo="#pwd" required>
            </div>
        </div>
        <div class="form-group mg0">
            <label for="email" class="col-sm-2 control-label"><span class="is-required">*</span> 邮箱地址</label>
            <div class="col-sm-10 form-item">
                <input type="email" class="form-control" id="email" ng-model="userForm.email" placeholder="请输入邮箱地址" required>
            </div>
        </div>
        <div class="form-group mg0">
            <label for="url" class="col-sm-2 control-label"><span class="is-required">*</span> URL</label>
            <div class="col-sm-10 form-item">
                <input type="url" class="form-control" id="url" ng-model="userForm.url" placeholder="请输入URL地址" required>
            </div>
        </div>
        <div class="form-group mg0">
            <label for="phone" class="col-sm-2 control-label"><span class="is-required">*</span> 联系方式</label>
            <div class="col-sm-10 form-item">
                <input type="text" class="form-control" id="phone" ng-model="userForm.phone" placeholder="请输入手机号码或者区号-号码" pattern="/^(1[3|4|5|7|8]\d{9})|(\(\d{3,4}\)|\d{3,4}-|\s){1}\d{7,14}$/" required>
            </div>
        </div>
        <div class="form-group mg0 mgb15">
            <label for="construct" class="col-sm-2 control-label"><span class="is-required">*</span> 用户权限</label>
            <div class="col-sm-10 form-item">
                <label class="col-lg-4 checkbox-inline pdr0" style="margin:0;" ng-repeat="item in state.roleOptions" ng-cloak>
                    <input type="checkbox" ng-value="item.id" ng-checked="item._status == true" ng-click="item._status = !item._status" minlength="1" maxlength="4" required> {{item.cnName}}
                </label>
            </div>
        </div>
        <div class="form-group mg0 mgb15">
            <label for="construct" class="col-sm-2 control-label"><span class="is-required">*</span> 自我介绍</label>
            <div class="col-sm-10 form-item">
                <textarea class="form-control" id="construct" rows="4" ng-model="userForm.construct" placeholder="请输入不超过200位" required maxlength="200"></textarea>
            </div>
        </div>
        <div class="form-group mg0">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="submit" class="btn btn-success btn-block" ng-click="clickVerify($event)">验证</button>
            </div>
        </div>
    </form>
    <!-- jquery validation e -->
    <style>
        .form-item {
            min-height: 50px;
        }
        
        .form-item input.error {
            border-color: red;
        }
        
        .form-item input.valid {
            border-color: green;
        }
        
        .form-item label.error {
            font-size: 12px;
            font-weight: 400;
            color: red;
        }
    </style>
    <script>
        $.validator.setDefaults({
            submitHandler: function() {
                alert("提交事件!");
            }
        });
        $(document).ready(function() {
            $("#J_myForm").validate();
        });
    </script>


    <form role="tabpanel" class="form-horizontal tab-pane fade" id="J_otherForm" method="post" novalidate>
        <div class="form-group mg0 mgt15 has-feedback">
            <label for="userName_other" class="col-sm-2 control-label"><span class="is-required">*</span> 用户名</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="userName_other" name="userName" placeholder="请输入2位及以上的数字、字母和中文组合" ng-model="userForm.userName_other">
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <label for="pwd_other" class="col-sm-2 control-label"><span class="is-required">*</span> 密码</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="pwd_other" name="pwd" placeholder="请输入8-25位数字字母组合" ng-model="userForm.pwd_other">
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <label for="repeat-pwd_other" class="col-sm-2 control-label"><span class="is-required">*</span> 确认密码</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="repeat-pwd_other" name="repeat_pwd" placeholder="请再次输入密码" ng-model="userForm.repeatPwd_other">
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <label for="email_other" class="col-sm-2 control-label"><span class="is-required">*</span> 邮箱地址</label>
            <div class="col-sm-10">
                <input type="email" class="form-control" id="email_other" name="email" placeholder="请输入邮箱地址" ng-model="userForm.email_other">
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <label for="url_other" class="col-sm-2 control-label"><span class="is-required">*</span> URL</label>
            <div class="col-sm-10">
                <input type="url" class="form-control" id="url_other" name="url" placeholder="请输入URL地址" ng-model="userForm.url_other">
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <label for="phone_other" class="col-sm-2 control-label"><span class="is-required">*</span> 联系方式</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="phone_other" name="phone" placeholder="请输入手机号码或者区号-号码" ng-model="userForm.phone_other">
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 mgb15 has-feedback">
            <label for="construct_other" class="col-sm-2 control-label"><span class="is-required">*</span> 用户权限</label>
            <div class="col-sm-10">
                <label class="col-lg-4 checkbox-inline pdr0" style="margin:0;" ng-repeat="item in state.roleOptions" ng-cloak>
                    <input type="checkbox" name="roles" ng-value="item.id" ng-checked="item._status == true" ng-click="item._status = !item._status"> {{item.cnName}}
                </label>
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <label for="construct_other" class="col-sm-2 control-label"><span class="is-required">*</span> 自我介绍</label>
            <div class="col-sm-10">
                <textarea class="form-control" id="construct_other" rows="4" name="construct" placeholder="请输入不超过200个字符（一个中文字算2个）" ng-model="userForm.construct_other"></textarea>
                <div class="error-section">
                </div>
            </div>
        </div>
        <div class="form-group mg0 has-feedback">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="submit" class="btn btn-success btn-block" ng-click="clickVerify($event)">验证</button>
            </div>
        </div>
    </form>
    <style>
        .has-error {
            border-color: red;
        }
        
        .has-success {
            border-color: green;
        }
        
        label.has-error,
        span.has-error {
            font-size: 12px;
            font-weight: 400;
            color: red;
        }
    </style>
    <script>
        // 中文字两个字节
        jQuery.validator.addMethod("byteRangeLength", function(value, element, param) {
            var length = value.length;
            for (var i = 0; i < value.length; i++) {
                if (value.charCodeAt(i) > 127) {
                    length++;
                }
            }
            return this.optional(element) || (length >= param[0] && length <= param[1]);
        }, $.validator.format("请确保输入的值在{0}-{1}个字节之间(一个中文字算2个字节)"));

        $(document).ready(function() {
            $("#J_otherForm").validate({
                errorClass: 'has-error',
                success: function(errEle) {
                    // console.log(errEle.parent().siblings());
                    var input = errEle.parent().siblings().eq(0);
                    var inputCont = input.parents('div').eq(0);
                    var errCont = errEle.parents('div').children('.error-section');
                    var succFlag = '<span class="sys-icon-ok form-control-feedback" aria-hidden="true"></span>';
                    // 清空错误信息
                    errCont.empty();
                    // 添加成功样式
                    input.removeClass('has-error').addClass('has-success');
                    // 添加成功标志
                    inputCont.children('.form-control-feedback').remove();
                    inputCont.append(succFlag);
                },
                errorElement: 'span',
                errorPlacement: function(error, element) {
                    // console.log(element.siblings());
                    var ele = element.parents('div').children('.error-section');
                    var input = element;
                    var parent = element.parents('div').eq(0);
                    var errFlag = '<span class="sys-icon-error form-control-feedback" aria-hidden="true"></span>';
                    // 添加错误信息
                    ele.empty().append(error);
                    // 添加错误样式
                    input.removeClass('has-success').addClass('has-error');
                    // 添加错误标志
                    parent.children('.form-control-feedback').remove();
                    parent.append(errFlag);
                },
                rules: {
                    userName: {
                        required: true,
                        minlength: 2,
                        pattern: /^[0-9a-zA-Z\u4e00-\u9fa5]+$/,
                        remote: {
                            url: '/apis/isExist/',
                            type: 'post',
                            dataType: "json",
                            data: {
                                userName: function() {
                                    return $('#userName_other').val();
                                }
                            }
                        }
                    },
                    pwd: {
                        required: true,
                        pattern: /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,25}$/
                    },
                    repeat_pwd: {
                        required: true,
                        pattern: /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,25}$/,
                        equalTo: '#pwd'
                    },
                    email: {
                        required: true,
                        email: true
                    },
                    url: {
                        required: true,
                        url: true
                    },
                    phone: {
                        required: true,
                        pattern: /^(1[3|4|5|7|8]\d{9})|(\(\d{3,4}\)|\d{3,4}-|\s){1}\d{7,14}$/
                    },
                    roles: {
                        required: true,
                        minlength: 1,
                        maxlength: 4
                    },
                    construct: {
                        required: true,
                        byteRangeLength: [1, 200]
                    }
                },
                messages: {
                    userName: {
                        required: '用户名不能为空',
                        minlength: '用户名最少两位',
                        pattern: '用户名只含有数字、字母和中文',
                        remote: '用户名已存在'
                    },
                    pwd: {
                        required: '密码不能为空',
                        pattern: '密码为8-25位数字和字母的组合'
                    },
                    repeat_pwd: {
                        required: '请输入确认密码',
                        pattern: '密码为8-25位数字和字母的组合',
                        equalTo: '两次输入不一致'
                    },
                    email: {
                        required: '邮件地址不能为空',
                        email: '邮件地址格式不正确'
                    },
                    url: {
                        required: 'URL不能为空',
                        url: 'URL格式不正确'
                    },
                    phone: {
                        required: '联系方式不能为空',
                        pattern: '联系方式为11位手机号码或者区号-号码'
                    },
                    roles: {
                        required: '请至少选择一项',
                        minlength: '请至少选择一项',
                        maxlength: '请至多选择四项'
                    },
                    construct: {
                        required: '自我介绍不能为空',
                        // byteRangeLength: "自我介绍不超过200个字符"
                    }
                }
            });
        });
    </script>
</div>